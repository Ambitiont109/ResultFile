!function(){function e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function t(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function n(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}(window.webpackJsonp=window.webpackJsonp||[]).push([[29],{DiO0:function(t,r,i){"use strict";i.r(r),i.d(r,"MessageCenterModule",(function(){return Z}));var a=i("ofXK"),s=i("tyNb"),o=i("CWoy"),c=i("XXKh"),l=i("wd/R"),d=i("vqVJ"),m=i("IfeN"),p=i("pwBI"),u=i("NdX7"),v=i("XNiG"),f=i("1G5W"),g=i("fXoL"),x=i("aceb"),h=i("sYmb");function S(e,t){if(1&e&&(g["\u0275\u0275elementStart"](0,"span"),g["\u0275\u0275text"](1),g["\u0275\u0275pipe"](2,"translate"),g["\u0275\u0275pipe"](3,"translate"),g["\u0275\u0275elementEnd"]()),2&e){var n=g["\u0275\u0275nextContext"]().$implicit,r=g["\u0275\u0275nextContext"]();g["\u0275\u0275advance"](1),g["\u0275\u0275textInterpolate2"]("",g["\u0275\u0275pipeBind1"](2,2,"Admin Center")," (",g["\u0275\u0275pipeBind1"](3,4,r.resolveSenderEmail(n)),")")}}function b(e,t){if(1&e&&(g["\u0275\u0275elementStart"](0,"span"),g["\u0275\u0275text"](1),g["\u0275\u0275pipe"](2,"translate"),g["\u0275\u0275elementEnd"]()),2&e){var n=g["\u0275\u0275nextContext"]().$implicit,r=g["\u0275\u0275nextContext"]();g["\u0275\u0275advance"](1),g["\u0275\u0275textInterpolate"](g["\u0275\u0275pipeBind1"](2,1,r.resolveSenderEmail(n)))}}function y(e,t){if(1&e&&(g["\u0275\u0275elementStart"](0,"span"),g["\u0275\u0275text"](1),g["\u0275\u0275pipe"](2,"translate"),g["\u0275\u0275pipe"](3,"translate"),g["\u0275\u0275elementEnd"]()),2&e){var n=g["\u0275\u0275nextContext"]().$implicit,r=g["\u0275\u0275nextContext"]();g["\u0275\u0275advance"](1),g["\u0275\u0275textInterpolate2"]("",g["\u0275\u0275pipeBind1"](2,2,"Admin Center")," (",g["\u0275\u0275pipeBind1"](3,4,r.resolveReceiverEmail(n)),")")}}function C(e,t){if(1&e&&(g["\u0275\u0275elementStart"](0,"span"),g["\u0275\u0275text"](1),g["\u0275\u0275pipe"](2,"translate"),g["\u0275\u0275elementEnd"]()),2&e){var n=g["\u0275\u0275nextContext"]().$implicit,r=g["\u0275\u0275nextContext"]();g["\u0275\u0275advance"](1),g["\u0275\u0275textInterpolate"](g["\u0275\u0275pipeBind1"](2,1,r.resolveReceiverEmail(n)))}}var I=function(e){return{"background-image":e}},E=function(e){return{"text-1":e}};function _(e,t){if(1&e){var n=g["\u0275\u0275getCurrentView"]();g["\u0275\u0275elementStart"](0,"nb-list-item",1),g["\u0275\u0275listener"]("click",(function(){g["\u0275\u0275restoreView"](n);var e=t.$implicit;return g["\u0275\u0275nextContext"]().goToMessageDetail(e)})),g["\u0275\u0275elementStart"](1,"div",2),g["\u0275\u0275elementStart"](2,"div",3),g["\u0275\u0275element"](3,"div",4),g["\u0275\u0275elementEnd"](),g["\u0275\u0275elementStart"](4,"div",5),g["\u0275\u0275elementStart"](5,"div",6),g["\u0275\u0275text"](6),g["\u0275\u0275pipe"](7,"translate"),g["\u0275\u0275template"](8,S,4,6,"span",7),g["\u0275\u0275template"](9,b,3,3,"span",7),g["\u0275\u0275text"](10),g["\u0275\u0275pipe"](11,"translate"),g["\u0275\u0275template"](12,y,4,6,"span",7),g["\u0275\u0275template"](13,C,3,3,"span",7),g["\u0275\u0275elementEnd"](),g["\u0275\u0275elementStart"](14,"div",8),g["\u0275\u0275text"](15),g["\u0275\u0275elementEnd"](),g["\u0275\u0275elementStart"](16,"div",9),g["\u0275\u0275text"](17),g["\u0275\u0275elementEnd"](),g["\u0275\u0275elementEnd"](),g["\u0275\u0275elementStart"](18,"div",10),g["\u0275\u0275elementStart"](19,"div"),g["\u0275\u0275text"](20),g["\u0275\u0275elementEnd"](),g["\u0275\u0275elementEnd"](),g["\u0275\u0275elementEnd"](),g["\u0275\u0275elementEnd"]()}if(2&e){var r=t.$implicit,i=g["\u0275\u0275nextContext"]();g["\u0275\u0275advance"](3),g["\u0275\u0275property"]("ngStyle",g["\u0275\u0275pureFunction1"](16,I,"url("+i.resolveSenderPictureUrl(r)+")")),g["\u0275\u0275advance"](3),g["\u0275\u0275textInterpolate1"](" ",g["\u0275\u0275pipeBind1"](7,12,"From"),": "),g["\u0275\u0275advance"](2),g["\u0275\u0275property"]("ngIf",i.isUserAdmin(r.sender)),g["\u0275\u0275advance"](1),g["\u0275\u0275property"]("ngIf",!i.isUserAdmin(r.sender)),g["\u0275\u0275advance"](1),g["\u0275\u0275textInterpolate1"](" ",g["\u0275\u0275pipeBind1"](11,14,"To"),": "),g["\u0275\u0275advance"](2),g["\u0275\u0275property"]("ngIf",i.isUserAdmin(r.receiver)),g["\u0275\u0275advance"](1),g["\u0275\u0275property"]("ngIf",!i.isUserAdmin(r.receiver)),g["\u0275\u0275advance"](1),g["\u0275\u0275property"]("ngClass",g["\u0275\u0275pureFunction1"](18,E,i.isRead(r))),g["\u0275\u0275advance"](1),g["\u0275\u0275textInterpolate1"](" ",r.subject," "),g["\u0275\u0275advance"](1),g["\u0275\u0275property"]("ngClass",g["\u0275\u0275pureFunction1"](20,E,i.isRead(r))),g["\u0275\u0275advance"](1),g["\u0275\u0275textInterpolate1"](" ",r.content," "),g["\u0275\u0275advance"](3),g["\u0275\u0275textInterpolate1"](" ",i.getFormatDate(r.created_at)," ")}}var w,k=((w=function(){function t(n,r,i,a,s,o){e(this,t),this.messageSerivce=n,this.route=r,this.userService=i,this.notificationService=a,this.router=s,this.toastService=o,this.destroy$=new v.a}return n(t,[{key:"ngOnInit",value:function(){var e=this;this.userService.getCurrentUser().subscribe((function(t){e.user=t})),this.messageSerivce.getHeaderMessagesOfCurrentUser().subscribe((function(t){e.messages=t,e.messages.sort((function(e,t){var n=l(e.created_at),r=l(t.created_at);return n.isAfter(r)?1:0}))})),this.notificationService.onnew.pipe(Object(f.a)(this.destroy$)).subscribe((function(t){t.data.verb==p.a.MessageCreate&&e.messageSerivce.getHeaderMessagesOfCurrentUser().subscribe((function(t){e.messages=t,e.messages.sort((function(e,t){var n=l(e.created_at),r=l(t.created_at);return n.isAfter(r)?1:0}))}))}))}},{key:"isUserAdmin",value:function(e){return e.role==o.a.Admin}},{key:"resolveSenderEmail",value:function(e){var t=e.sender;return t.id==this.user.id?"me":t.role==o.a.Admin?"".concat(t.first_name," ").concat(t.last_name):t.role==o.a.Parent?e.child.first_name+" "+e.child.last_name:t.first_name+" "+t.last_name}},{key:"resolveReceiverEmail",value:function(e){var t=e.receiver;return t.id==this.user.id?"me":t.role==o.a.Admin?"".concat(t.first_name," ").concat(t.last_name):t.role==o.a.Parent?e.child.first_name+" "+e.child.last_name:t.first_name+" "+t.last_name}},{key:"resolveSenderPictureUrl",value:function(e){return e.sender.role==o.a.Parent?e.child.photo:e.sender.picture}},{key:"getFormatDate",value:function(e){var t=l(e);return t.isValid?t.format("LT"):""}},{key:"goToMessageDetail",value:function(e){this.router.navigate(e.headerMessage?[e.headerMessage]:[e.id],{relativeTo:this.route})}},{key:"ngOnDestroy",value:function(){this.destroy$.next(),this.destroy$.complete()}},{key:"isRead",value:function(e){return e.receiver.role!=this.user.role||(this.user.role==o.a.Parent?this.user.child.sibling_group!=e.receiver.child.sibling_group||e.is_read:this.user.id!=e.receiver.id||e.is_read)}}]),t}()).\u0275fac=function(e){return new(e||w)(g["\u0275\u0275directiveInject"](c.a),g["\u0275\u0275directiveInject"](s.a),g["\u0275\u0275directiveInject"](d.a),g["\u0275\u0275directiveInject"](m.a),g["\u0275\u0275directiveInject"](s.c),g["\u0275\u0275directiveInject"](u.a))},w.\u0275cmp=g["\u0275\u0275defineComponent"]({type:w,selectors:[["ngx-message-center"]],decls:7,vars:4,consts:[[3,"click",4,"ngFor","ngForOf"],[3,"click"],[1,"row","justify-content-center","w-100"],[1,"avatar","ml-2"],[1,"content",3,"ngStyle"],[1,"ml-3"],[1,"text-1"],[4,"ngIf"],[1,"mt-2",3,"ngClass"],[1,"mt-2",2,"white-space","nowrap","overflow","hidden","text-overflow","ellipsis","max-width","300px",3,"ngClass"],[1,"ml-auto"]],template:function(e,t){1&e&&(g["\u0275\u0275elementStart"](0,"nb-card"),g["\u0275\u0275elementStart"](1,"nb-card-header"),g["\u0275\u0275text"](2),g["\u0275\u0275pipe"](3,"translate"),g["\u0275\u0275elementEnd"](),g["\u0275\u0275elementStart"](4,"nb-card-body"),g["\u0275\u0275elementStart"](5,"nb-list"),g["\u0275\u0275template"](6,_,21,22,"nb-list-item",0),g["\u0275\u0275elementEnd"](),g["\u0275\u0275elementEnd"](),g["\u0275\u0275elementEnd"]()),2&e&&(g["\u0275\u0275advance"](2),g["\u0275\u0275textInterpolate1"](" ",g["\u0275\u0275pipeBind1"](3,2,"Message Center")," "),g["\u0275\u0275advance"](4),g["\u0275\u0275property"]("ngForOf",t.messages))},directives:[x.u,x.x,x.t,x.U,a.n,x.V,a.p,a.o,a.m],pipes:[h.c],styles:[".avatar[_ngcontent-%COMP%]{width:50px;height:50px}.avatar[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]{width:100%;position:relative;padding-top:100%;background-size:cover;background-repeat:no-repeat;border-radius:50%;box-shadow:0 0 5px .5px #fff}nb-list-item[_ngcontent-%COMP%]   .text-1[_ngcontent-%COMP%]{font-size:small;color:grey}"]}),w),M=i("hpVs"),U=i("eIep"),j=i("cp0P"),O=i("fUYe");function P(e,t){if(1&e&&(g["\u0275\u0275elementStart"](0,"span"),g["\u0275\u0275text"](1),g["\u0275\u0275pipe"](2,"translate"),g["\u0275\u0275pipe"](3,"translate"),g["\u0275\u0275elementEnd"]()),2&e){var n=g["\u0275\u0275nextContext"](2).$implicit,r=g["\u0275\u0275nextContext"]();g["\u0275\u0275advance"](1),g["\u0275\u0275textInterpolate2"]("",g["\u0275\u0275pipeBind1"](2,2,"Admin Center")," (",g["\u0275\u0275pipeBind1"](3,4,r.resolveSenderEmail(n)),")")}}function B(e,t){if(1&e&&(g["\u0275\u0275elementStart"](0,"span"),g["\u0275\u0275text"](1),g["\u0275\u0275pipe"](2,"translate"),g["\u0275\u0275elementEnd"]()),2&e){var n=g["\u0275\u0275nextContext"](2).$implicit,r=g["\u0275\u0275nextContext"]();g["\u0275\u0275advance"](1),g["\u0275\u0275textInterpolate"](g["\u0275\u0275pipeBind1"](2,1,r.resolveSenderEmail(n)))}}function F(e,t){if(1&e&&(g["\u0275\u0275elementStart"](0,"span"),g["\u0275\u0275text"](1),g["\u0275\u0275pipe"](2,"translate"),g["\u0275\u0275pipe"](3,"translate"),g["\u0275\u0275elementEnd"]()),2&e){var n=g["\u0275\u0275nextContext"](2).$implicit,r=g["\u0275\u0275nextContext"]();g["\u0275\u0275advance"](1),g["\u0275\u0275textInterpolate2"]("",g["\u0275\u0275pipeBind1"](2,2,"Admin Center")," (",g["\u0275\u0275pipeBind1"](3,4,r.resolveReceiverEmail(n)),")")}}function A(e,t){if(1&e&&(g["\u0275\u0275elementStart"](0,"span"),g["\u0275\u0275text"](1),g["\u0275\u0275pipe"](2,"translate"),g["\u0275\u0275elementEnd"]()),2&e){var n=g["\u0275\u0275nextContext"](2).$implicit,r=g["\u0275\u0275nextContext"]();g["\u0275\u0275advance"](1),g["\u0275\u0275textInterpolate"](g["\u0275\u0275pipeBind1"](2,1,r.resolveReceiverEmail(n)))}}function R(e,t){if(1&e&&(g["\u0275\u0275elementContainerStart"](0),g["\u0275\u0275element"](1,"img",21),g["\u0275\u0275elementContainerEnd"]()),2&e){var n=t.$implicit;g["\u0275\u0275advance"](1),g["\u0275\u0275property"]("src",n.file,g["\u0275\u0275sanitizeUrl"])}}var $=function(e){return{"background-image":e}};function T(e,t){if(1&e&&(g["\u0275\u0275elementStart"](0,"div",9),g["\u0275\u0275element"](1,"div",10),g["\u0275\u0275elementStart"](2,"div",11),g["\u0275\u0275elementStart"](3,"div",12),g["\u0275\u0275elementStart"](4,"div",13),g["\u0275\u0275elementStart"](5,"div",14),g["\u0275\u0275text"](6),g["\u0275\u0275elementEnd"](),g["\u0275\u0275text"](7),g["\u0275\u0275pipe"](8,"translate"),g["\u0275\u0275template"](9,P,4,6,"span",15),g["\u0275\u0275template"](10,B,3,3,"span",15),g["\u0275\u0275text"](11),g["\u0275\u0275pipe"](12,"translate"),g["\u0275\u0275template"](13,F,4,6,"span",15),g["\u0275\u0275template"](14,A,3,3,"span",15),g["\u0275\u0275elementEnd"](),g["\u0275\u0275elementStart"](15,"div",16),g["\u0275\u0275element"](16,"div",17),g["\u0275\u0275elementEnd"](),g["\u0275\u0275elementEnd"](),g["\u0275\u0275elementStart"](17,"div",18),g["\u0275\u0275elementStart"](18,"div",19),g["\u0275\u0275text"](19),g["\u0275\u0275elementEnd"](),g["\u0275\u0275elementStart"](20,"div",20),g["\u0275\u0275template"](21,R,2,1,"ng-container",3),g["\u0275\u0275elementEnd"](),g["\u0275\u0275elementEnd"](),g["\u0275\u0275elementEnd"](),g["\u0275\u0275elementEnd"]()),2&e){var n=g["\u0275\u0275nextContext"]().$implicit,r=g["\u0275\u0275nextContext"]();g["\u0275\u0275advance"](6),g["\u0275\u0275textInterpolate1"](" ",r.getFormatDate(n.created_at)," "),g["\u0275\u0275advance"](1),g["\u0275\u0275textInterpolate1"](" ",g["\u0275\u0275pipeBind1"](8,10,"From"),": "),g["\u0275\u0275advance"](2),g["\u0275\u0275property"]("ngIf",r.isUserAdmin(n.sender)),g["\u0275\u0275advance"](1),g["\u0275\u0275property"]("ngIf",!r.isUserAdmin(n.sender)),g["\u0275\u0275advance"](1),g["\u0275\u0275textInterpolate1"](" ",g["\u0275\u0275pipeBind1"](12,12,"To"),": "),g["\u0275\u0275advance"](2),g["\u0275\u0275property"]("ngIf",r.isUserAdmin(n.receiver)),g["\u0275\u0275advance"](1),g["\u0275\u0275property"]("ngIf",!r.isUserAdmin(n.receiver)),g["\u0275\u0275advance"](2),g["\u0275\u0275property"]("ngStyle",g["\u0275\u0275pureFunction1"](14,$,"url("+r.resolveSenderPictureUrl(n)+")")),g["\u0275\u0275advance"](3),g["\u0275\u0275textInterpolate1"](" ",n.content," "),g["\u0275\u0275advance"](2),g["\u0275\u0275property"]("ngForOf",n.attachedFiles)}}function V(e,t){if(1&e&&(g["\u0275\u0275elementContainerStart"](0),g["\u0275\u0275elementStart"](1,"a",29),g["\u0275\u0275element"](2,"img",21),g["\u0275\u0275elementEnd"](),g["\u0275\u0275elementContainerEnd"]()),2&e){var n=t.$implicit;g["\u0275\u0275advance"](1),g["\u0275\u0275propertyInterpolate"]("href",n.file,g["\u0275\u0275sanitizeUrl"]),g["\u0275\u0275advance"](1),g["\u0275\u0275property"]("src",n.file,g["\u0275\u0275sanitizeUrl"])}}function z(e,t){if(1&e&&(g["\u0275\u0275elementStart"](0,"div",9),g["\u0275\u0275elementStart"](1,"div",22),g["\u0275\u0275elementStart"](2,"div",23),g["\u0275\u0275elementStart"](3,"div",24),g["\u0275\u0275element"](4,"div",17),g["\u0275\u0275elementEnd"](),g["\u0275\u0275elementStart"](5,"div",25),g["\u0275\u0275elementStart"](6,"div",26),g["\u0275\u0275text"](7),g["\u0275\u0275elementEnd"](),g["\u0275\u0275text"](8),g["\u0275\u0275pipe"](9,"translate"),g["\u0275\u0275elementStart"](10,"span"),g["\u0275\u0275text"](11),g["\u0275\u0275elementEnd"](),g["\u0275\u0275text"](12),g["\u0275\u0275pipe"](13,"translate"),g["\u0275\u0275elementStart"](14,"span"),g["\u0275\u0275text"](15),g["\u0275\u0275elementEnd"](),g["\u0275\u0275elementEnd"](),g["\u0275\u0275elementEnd"](),g["\u0275\u0275elementStart"](16,"div",18),g["\u0275\u0275elementStart"](17,"div",27),g["\u0275\u0275text"](18),g["\u0275\u0275elementEnd"](),g["\u0275\u0275elementStart"](19,"div",28),g["\u0275\u0275template"](20,V,3,2,"ng-container",3),g["\u0275\u0275elementEnd"](),g["\u0275\u0275elementEnd"](),g["\u0275\u0275elementEnd"](),g["\u0275\u0275elementEnd"]()),2&e){var n=g["\u0275\u0275nextContext"]().$implicit,r=g["\u0275\u0275nextContext"]();g["\u0275\u0275advance"](4),g["\u0275\u0275property"]("ngStyle",g["\u0275\u0275pureFunction1"](12,$,"url("+r.resolveSenderPictureUrl(n)+")")),g["\u0275\u0275advance"](3),g["\u0275\u0275textInterpolate1"](" ",r.getFormatDate(n.created_at)," "),g["\u0275\u0275advance"](1),g["\u0275\u0275textInterpolate1"](" ",g["\u0275\u0275pipeBind1"](9,8,"From"),": "),g["\u0275\u0275advance"](3),g["\u0275\u0275textInterpolate"](r.resolveSenderEmail(n)),g["\u0275\u0275advance"](1),g["\u0275\u0275textInterpolate1"](" ",g["\u0275\u0275pipeBind1"](13,10,"To"),":"),g["\u0275\u0275advance"](3),g["\u0275\u0275textInterpolate"](r.resolveReceiverEmail(n)),g["\u0275\u0275advance"](3),g["\u0275\u0275textInterpolate1"](" ",n.content," "),g["\u0275\u0275advance"](2),g["\u0275\u0275property"]("ngForOf",n.attachedFiles)}}function N(e,t){if(1&e&&(g["\u0275\u0275elementStart"](0,"nb-list-item"),g["\u0275\u0275template"](1,T,22,16,"div",7),g["\u0275\u0275template"](2,z,21,14,"ng-template",null,8,g["\u0275\u0275templateRefExtractor"]),g["\u0275\u0275elementEnd"]()),2&e){var n=t.$implicit,r=g["\u0275\u0275reference"](3),i=g["\u0275\u0275nextContext"]();g["\u0275\u0275advance"](1),g["\u0275\u0275property"]("ngIf",n.sender.id!=(null==i.currentUser?null:i.currentUser.id))("ngIfElse",r)}}function D(e,t){if(1&e){var n=g["\u0275\u0275getCurrentView"]();g["\u0275\u0275elementStart"](0,"button",30),g["\u0275\u0275listener"]("click",(function(){return g["\u0275\u0275restoreView"](n),g["\u0275\u0275nextContext"]().isReplyMode=!0})),g["\u0275\u0275text"](1),g["\u0275\u0275pipe"](2,"translate"),g["\u0275\u0275elementEnd"]()}2&e&&(g["\u0275\u0275advance"](1),g["\u0275\u0275textInterpolate"](g["\u0275\u0275pipeBind1"](2,1,"Reply")))}function L(e,t){if(1&e){var n=g["\u0275\u0275getCurrentView"]();g["\u0275\u0275elementStart"](0,"div",31),g["\u0275\u0275elementStart"](1,"button",32),g["\u0275\u0275listener"]("click",(function(){return g["\u0275\u0275restoreView"](n),g["\u0275\u0275nextContext"]().isReplyMode=!1})),g["\u0275\u0275element"](2,"nb-icon",33),g["\u0275\u0275elementEnd"](),g["\u0275\u0275elementStart"](3,"ngx-reply",34),g["\u0275\u0275listener"]("onsend",(function(e){return g["\u0275\u0275restoreView"](n),g["\u0275\u0275nextContext"]().onSend(e)})),g["\u0275\u0275elementEnd"](),g["\u0275\u0275elementEnd"]()}if(2&e){var r=g["\u0275\u0275nextContext"]();g["\u0275\u0275advance"](3),g["\u0275\u0275property"]("isReplyMode",!0)("fromContact",r.currentUser)}}var X,J,K,W,q=((X=function(){function t(n,r,i,a,s,o){e(this,t),this.messageSerivce=n,this.userSerivce=r,this.notificationService=i,this.route=a,this.router=s,this._location=o,this.destroy$=new v.a}return n(t,[{key:"ngOnInit",value:function(){var e=this;this.userSerivce.getCurrentUser().subscribe((function(t){e.currentUser=t})),this.route.paramMap.pipe(Object(U.a)((function(t){return e.headermsgId=Number(t.get("id")),Object(j.a)({user:e.userSerivce.getCurrentUser(),msg:e.messageSerivce.getMessageLinked(e.headermsgId)})}))).subscribe((function(t){e.currentUser=t.user,e.messages=t.msg,e._initialize(),e.notificationService.onnew.pipe(Object(f.a)(e.destroy$)).subscribe((function(t){t.data.verb==p.a.MessageCreate&&t.receiver==e.currentUser.id&&e.messageSerivce.getMessageLinked(e.headermsgId).subscribe((function(t){e.messages=t,e._initialize()}))}))})),this.isReplyMode=!1}},{key:"_initialize",value:function(){this.toContact=this.messages[0].sender.id==this.currentUser.id?this.messages[0].receiver:this.messages[0].sender;var e=this.messages[this.messages.length-1];0==e.is_read&&e.receiver.id==this.currentUser.id&&this.messageSerivce.markAsRead(e).subscribe((function(e){})),this.toChild=this.messages[0].child}},{key:"isUserAdmin",value:function(e){return e.role==o.a.Admin}},{key:"getFormatDate",value:function(e){var t=l(e);return t.isValid?t.format("LT"):""}},{key:"goToMessageCenter",value:function(){this._location.back()}},{key:"resolveSenderEmail",value:function(e){var t=e.sender;return t.id==this.currentUser.id?"me":t.role==o.a.Admin?"".concat(t.first_name," ").concat(t.last_name):t.role==o.a.Parent?e.child.first_name+" "+e.child.last_name:t.first_name+" "+t.last_name}},{key:"resolveReceiverEmail",value:function(e){var t=e.receiver;return t.id==this.currentUser.id?"me":t.role==o.a.Admin?"".concat(t.first_name," ").concat(t.last_name):t.role==o.a.Parent?e.child.first_name+" "+e.child.last_name:t.first_name+" "+t.last_name}},{key:"resolveReceiverPictureUrl",value:function(e){return e.receiver.role==o.a.Parent?e.child.photo:e.sender.picture}},{key:"resolveSenderPictureUrl",value:function(e){return e.sender.role==o.a.Parent?e.child.photo:e.sender.picture}},{key:"onSend",value:function(e){var t=this,n=this.messageSerivce.newMessage();n.subject=this.messages[0].subject,n.content=e.content,n.msgType=M.a.Normal,n.attachedFiles=e.fileIds,n.sender=this.currentUser,n.child=this.toChild,n.headerMessage=this.headermsgId,n.receiver=this.toContact,this.messageSerivce.sendMessage(n).subscribe((function(e){t.isReplyMode=!1,t.messageSerivce.getMessageLinked(t.headermsgId).subscribe((function(e){t.messages=e}))}))}}]),t}()).\u0275fac=function(e){return new(e||X)(g["\u0275\u0275directiveInject"](c.a),g["\u0275\u0275directiveInject"](d.a),g["\u0275\u0275directiveInject"](m.a),g["\u0275\u0275directiveInject"](s.a),g["\u0275\u0275directiveInject"](s.c),g["\u0275\u0275directiveInject"](a.k))},X.\u0275cmp=g["\u0275\u0275defineComponent"]({type:X,selectors:[["ngx-message-detail"]],decls:14,vars:9,consts:[["nbButton","","ghost","",3,"nbTooltip","click"],["icon","arrow-back-outline",2,"color","white"],[2,"max-height","600px"],[4,"ngFor","ngForOf"],[1,"d-flex","justify-content-end"],["nbButton","","class","",3,"click",4,"ngIf"],["style","position: relative;",4,"ngIf"],["class","row w-100",4,"ngIf","ngIfElse"],["hostContent",""],[1,"row","w-100"],[1,"col-2"],[1,"col-10","justify-content-end","w-100"],[1,"row","justify-content-end"],[1,"text-1"],[1,"ml-2","date-text","text-right"],[4,"ngIf"],[1,"avatar","ml-2"],[1,"content",3,"ngStyle"],[1,"ml-3"],[1,"mt-2","mb-2","text-right"],[1,"row","attached-content","justify-content-end"],[1,"attached-img","mr-2","mt-2",3,"src"],[1,"col-10","w-100","ml-2"],[1,"row"],[1,"avatar","text-right"],[1,"text-1","ml-2"],[1,"date-text"],[1,"mt-2","mb-2"],[1,"row","attached-content"],["target","_blank",3,"href"],["nbButton","",1,"",3,"click"],[2,"position","relative"],["nbButton","","ghost","",2,"position","absolute","right","0px","top","0px","z-index","99",3,"click"],["icon","close-outline"],[3,"isReplyMode","fromContact","onsend"]],template:function(e,t){1&e&&(g["\u0275\u0275elementStart"](0,"nb-card"),g["\u0275\u0275elementStart"](1,"nb-card-header"),g["\u0275\u0275elementStart"](2,"button",0),g["\u0275\u0275listener"]("click",(function(){return t.goToMessageCenter()})),g["\u0275\u0275pipe"](3,"translate"),g["\u0275\u0275elementStart"](4,"nb-icon",1),g["\u0275\u0275text"](5,"arrow-back-outline"),g["\u0275\u0275elementEnd"](),g["\u0275\u0275elementEnd"](),g["\u0275\u0275text"](6),g["\u0275\u0275pipe"](7,"translate"),g["\u0275\u0275elementEnd"](),g["\u0275\u0275elementStart"](8,"nb-card-body"),g["\u0275\u0275elementStart"](9,"nb-list",2),g["\u0275\u0275template"](10,N,4,2,"nb-list-item",3),g["\u0275\u0275elementEnd"](),g["\u0275\u0275elementStart"](11,"div",4),g["\u0275\u0275template"](12,D,3,3,"button",5),g["\u0275\u0275elementEnd"](),g["\u0275\u0275template"](13,L,4,2,"div",6),g["\u0275\u0275elementEnd"](),g["\u0275\u0275elementEnd"]()),2&e&&(g["\u0275\u0275advance"](2),g["\u0275\u0275propertyInterpolate"]("nbTooltip",g["\u0275\u0275pipeBind1"](3,5,"Back")),g["\u0275\u0275advance"](4),g["\u0275\u0275textInterpolate1"](" ",g["\u0275\u0275pipeBind1"](7,7,"Messages")," "),g["\u0275\u0275advance"](4),g["\u0275\u0275property"]("ngForOf",t.messages),g["\u0275\u0275advance"](2),g["\u0275\u0275property"]("ngIf",!t.isReplyMode),g["\u0275\u0275advance"](1),g["\u0275\u0275property"]("ngIf",t.isReplyMode))},directives:[x.u,x.x,x.q,x.ub,x.I,x.t,x.U,a.n,a.o,x.V,a.p,O.a],pipes:[h.c],styles:[".avatar[_ngcontent-%COMP%]{width:50px;height:50px}.avatar[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]{width:100%;position:relative;padding-top:100%;background-size:cover;background-repeat:no-repeat;border-radius:50%;box-shadow:0 0 5px .5px #fff}nb-list-item[_ngcontent-%COMP%]   .text-1[_ngcontent-%COMP%]{font-size:small;color:grey}nb-list-item[_ngcontent-%COMP%]   .date-text[_ngcontent-%COMP%]{font-size:medium}.attached-content[_ngcontent-%COMP%]{flex-wrap:wrap}.attached-content[_ngcontent-%COMP%]   .attached-img[_ngcontent-%COMP%]{max-height:70px;border-radius:5px;border:1px solid #8f9bb3}"]}),X),G=[{path:"",component:k},{path:"compose",component:(J=function(){function t(n,r,i){e(this,t),this.userService=n,this.messageSerivce=r,this.toastService=i}return n(t,[{key:"ngOnInit",value:function(){var e=this;this.userService.getCurrentUser().subscribe((function(t){e.currentUser=t}))}},{key:"onSend",value:function(e){var t=this,n=[];e.to_contacts.forEach((function(r){var i=t.messageSerivce.newMessage();i.subject=e.subject,i.content=e.content,i.msgType=M.a.Normal,i.attachedFiles=e.isAttached?e.fileIds:[],i.sender=t.currentUser,i.child=r.child,i.receiver=r.user,n.push(t.messageSerivce.sendMessage(i))})),n.length>0&&Object(j.a)(n).subscribe((function(e){t.toastService.success("Message has been sent successfully","success")}))}}]),t}(),J.\u0275fac=function(e){return new(e||J)(g["\u0275\u0275directiveInject"](d.a),g["\u0275\u0275directiveInject"](c.a),g["\u0275\u0275directiveInject"](u.a))},J.\u0275cmp=g["\u0275\u0275defineComponent"]({type:J,selectors:[["ngx-compose-message"]],decls:1,vars:1,consts:[[3,"fromContact","onsend"]],template:function(e,t){1&e&&(g["\u0275\u0275elementStart"](0,"ngx-reply",0),g["\u0275\u0275listener"]("onsend",(function(e){return t.onSend(e)})),g["\u0275\u0275elementEnd"]()),2&e&&g["\u0275\u0275property"]("fromContact",t.currentUser)},directives:[O.a],styles:[""]}),J)},{path:":id",component:q}],H=((K=function t(){e(this,t)}).\u0275mod=g["\u0275\u0275defineNgModule"]({type:K}),K.\u0275inj=g["\u0275\u0275defineInjector"]({factory:function(e){return new(e||K)},imports:[[s.g.forChild(G)],s.g]}),K),Y=i("PCNd"),Q=i("p0MU"),Z=((W=function t(){e(this,t)}).\u0275mod=g["\u0275\u0275defineNgModule"]({type:W}),W.\u0275inj=g["\u0275\u0275defineInjector"]({factory:function(e){return new(e||W)},imports:[[a.c,H,x.y,x.W,x.r,Y.a,x.K,x.vb,Q.a]]}),W)}}])}();