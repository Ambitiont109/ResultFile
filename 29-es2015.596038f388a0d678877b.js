(window.webpackJsonp=window.webpackJsonp||[]).push([[29],{DiO0:function(e,t,n){"use strict";n.r(t),n.d(t,"MessageCenterModule",(function(){return K}));var r=n("ofXK"),i=n("tyNb"),a=n("CWoy"),s=n("XXKh"),o=n("wd/R"),l=n("vqVJ"),c=n("IfeN"),d=n("pwBI"),m=n("NdX7"),p=n("XNiG"),u=n("1G5W"),v=n("fXoL"),g=n("aceb"),h=n("sYmb");function x(e,t){if(1&e&&(v["\u0275\u0275elementStart"](0,"span"),v["\u0275\u0275text"](1),v["\u0275\u0275pipe"](2,"translate"),v["\u0275\u0275pipe"](3,"translate"),v["\u0275\u0275elementEnd"]()),2&e){const e=v["\u0275\u0275nextContext"]().$implicit,t=v["\u0275\u0275nextContext"]();v["\u0275\u0275advance"](1),v["\u0275\u0275textInterpolate2"]("",v["\u0275\u0275pipeBind1"](2,2,"Admin Center")," (",v["\u0275\u0275pipeBind1"](3,4,t.resolveSenderEmail(e)),")")}}function f(e,t){if(1&e&&(v["\u0275\u0275elementStart"](0,"span"),v["\u0275\u0275text"](1),v["\u0275\u0275pipe"](2,"translate"),v["\u0275\u0275elementEnd"]()),2&e){const e=v["\u0275\u0275nextContext"]().$implicit,t=v["\u0275\u0275nextContext"]();v["\u0275\u0275advance"](1),v["\u0275\u0275textInterpolate"](v["\u0275\u0275pipeBind1"](2,1,t.resolveSenderEmail(e)))}}function S(e,t){if(1&e&&(v["\u0275\u0275elementStart"](0,"span"),v["\u0275\u0275text"](1),v["\u0275\u0275pipe"](2,"translate"),v["\u0275\u0275pipe"](3,"translate"),v["\u0275\u0275elementEnd"]()),2&e){const e=v["\u0275\u0275nextContext"]().$implicit,t=v["\u0275\u0275nextContext"]();v["\u0275\u0275advance"](1),v["\u0275\u0275textInterpolate2"]("",v["\u0275\u0275pipeBind1"](2,2,"Admin Center")," (",v["\u0275\u0275pipeBind1"](3,4,t.resolveReceiverEmail(e)),")")}}function b(e,t){if(1&e&&(v["\u0275\u0275elementStart"](0,"span"),v["\u0275\u0275text"](1),v["\u0275\u0275pipe"](2,"translate"),v["\u0275\u0275elementEnd"]()),2&e){const e=v["\u0275\u0275nextContext"]().$implicit,t=v["\u0275\u0275nextContext"]();v["\u0275\u0275advance"](1),v["\u0275\u0275textInterpolate"](v["\u0275\u0275pipeBind1"](2,1,t.resolveReceiverEmail(e)))}}const C=function(e){return{"background-image":e}},I=function(e){return{"text-1":e}};function y(e,t){if(1&e){const e=v["\u0275\u0275getCurrentView"]();v["\u0275\u0275elementStart"](0,"nb-list-item",1),v["\u0275\u0275listener"]("click",(function(){v["\u0275\u0275restoreView"](e);const n=t.$implicit;return v["\u0275\u0275nextContext"]().goToMessageDetail(n)})),v["\u0275\u0275elementStart"](1,"div",2),v["\u0275\u0275elementStart"](2,"div",3),v["\u0275\u0275element"](3,"div",4),v["\u0275\u0275elementEnd"](),v["\u0275\u0275elementStart"](4,"div",5),v["\u0275\u0275elementStart"](5,"div",6),v["\u0275\u0275text"](6),v["\u0275\u0275pipe"](7,"translate"),v["\u0275\u0275template"](8,x,4,6,"span",7),v["\u0275\u0275template"](9,f,3,3,"span",7),v["\u0275\u0275text"](10),v["\u0275\u0275pipe"](11,"translate"),v["\u0275\u0275template"](12,S,4,6,"span",7),v["\u0275\u0275template"](13,b,3,3,"span",7),v["\u0275\u0275elementEnd"](),v["\u0275\u0275elementStart"](14,"div",8),v["\u0275\u0275text"](15),v["\u0275\u0275elementEnd"](),v["\u0275\u0275elementStart"](16,"div",9),v["\u0275\u0275text"](17),v["\u0275\u0275elementEnd"](),v["\u0275\u0275elementEnd"](),v["\u0275\u0275elementStart"](18,"div",10),v["\u0275\u0275elementStart"](19,"div"),v["\u0275\u0275text"](20),v["\u0275\u0275elementEnd"](),v["\u0275\u0275elementEnd"](),v["\u0275\u0275elementEnd"](),v["\u0275\u0275elementEnd"]()}if(2&e){const e=t.$implicit,n=v["\u0275\u0275nextContext"]();v["\u0275\u0275advance"](3),v["\u0275\u0275property"]("ngStyle",v["\u0275\u0275pureFunction1"](16,C,"url("+n.resolveSenderPictureUrl(e)+")")),v["\u0275\u0275advance"](3),v["\u0275\u0275textInterpolate1"](" ",v["\u0275\u0275pipeBind1"](7,12,"From"),": "),v["\u0275\u0275advance"](2),v["\u0275\u0275property"]("ngIf",n.isUserAdmin(e.sender)),v["\u0275\u0275advance"](1),v["\u0275\u0275property"]("ngIf",!n.isUserAdmin(e.sender)),v["\u0275\u0275advance"](1),v["\u0275\u0275textInterpolate1"](" ",v["\u0275\u0275pipeBind1"](11,14,"To"),": "),v["\u0275\u0275advance"](2),v["\u0275\u0275property"]("ngIf",n.isUserAdmin(e.receiver)),v["\u0275\u0275advance"](1),v["\u0275\u0275property"]("ngIf",!n.isUserAdmin(e.receiver)),v["\u0275\u0275advance"](1),v["\u0275\u0275property"]("ngClass",v["\u0275\u0275pureFunction1"](18,I,n.isRead(e))),v["\u0275\u0275advance"](1),v["\u0275\u0275textInterpolate1"](" ",e.subject," "),v["\u0275\u0275advance"](1),v["\u0275\u0275property"]("ngClass",v["\u0275\u0275pureFunction1"](20,I,n.isRead(e))),v["\u0275\u0275advance"](1),v["\u0275\u0275textInterpolate1"](" ",e.content," "),v["\u0275\u0275advance"](3),v["\u0275\u0275textInterpolate1"](" ",n.getFormatDate(e.created_at)," ")}}let E=(()=>{class e{constructor(e,t,n,r,i,a){this.messageSerivce=e,this.route=t,this.userService=n,this.notificationService=r,this.router=i,this.toastService=a,this.destroy$=new p.a}ngOnInit(){this.userService.getCurrentUser().subscribe(e=>{this.user=e}),this.messageSerivce.getHeaderMessagesOfCurrentUser().subscribe(e=>{this.messages=e,this.messages.sort((e,t)=>{let n=o(e.created_at),r=o(t.created_at);return n.isAfter(r)?1:0})}),this.notificationService.onnew.pipe(Object(u.a)(this.destroy$)).subscribe(e=>{e.data.verb==d.a.MessageCreate&&this.messageSerivce.getHeaderMessagesOfCurrentUser().subscribe(e=>{this.messages=e,this.messages.sort((e,t)=>{let n=o(e.created_at),r=o(t.created_at);return n.isAfter(r)?1:0})})})}isUserAdmin(e){return e.role==a.a.Admin}resolveSenderEmail(e){let t=e.sender;return t.id==this.user.id?"me":t.role==a.a.Admin?`${t.first_name} ${t.last_name}`:t.role==a.a.Parent?e.child.first_name+" "+e.child.last_name:t.first_name+" "+t.last_name}resolveReceiverEmail(e){let t=e.receiver;return t.id==this.user.id?"me":t.role==a.a.Admin?`${t.first_name} ${t.last_name}`:t.role==a.a.Parent?e.child.first_name+" "+e.child.last_name:t.first_name+" "+t.last_name}resolveSenderPictureUrl(e){return e.sender.role==a.a.Parent?e.child.photo:e.sender.picture}getFormatDate(e){let t=o(e);return t.isValid?t.format("LT"):""}goToMessageDetail(e){this.router.navigate(e.headerMessage?[e.headerMessage]:[e.id],{relativeTo:this.route})}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}isRead(e){return e.receiver.role!=this.user.role||(this.user.role==a.a.Parent?this.user.child.sibling_group!=e.receiver.child.sibling_group||e.is_read:this.user.id!=e.receiver.id||e.is_read)}}return e.\u0275fac=function(t){return new(t||e)(v["\u0275\u0275directiveInject"](s.a),v["\u0275\u0275directiveInject"](i.a),v["\u0275\u0275directiveInject"](l.a),v["\u0275\u0275directiveInject"](c.a),v["\u0275\u0275directiveInject"](i.c),v["\u0275\u0275directiveInject"](m.a))},e.\u0275cmp=v["\u0275\u0275defineComponent"]({type:e,selectors:[["ngx-message-center"]],decls:7,vars:4,consts:[[3,"click",4,"ngFor","ngForOf"],[3,"click"],[1,"row","justify-content-center","w-100"],[1,"avatar","ml-2"],[1,"content",3,"ngStyle"],[1,"ml-3"],[1,"text-1"],[4,"ngIf"],[1,"mt-2",3,"ngClass"],[1,"mt-2",2,"white-space","nowrap","overflow","hidden","text-overflow","ellipsis","max-width","300px",3,"ngClass"],[1,"ml-auto"]],template:function(e,t){1&e&&(v["\u0275\u0275elementStart"](0,"nb-card"),v["\u0275\u0275elementStart"](1,"nb-card-header"),v["\u0275\u0275text"](2),v["\u0275\u0275pipe"](3,"translate"),v["\u0275\u0275elementEnd"](),v["\u0275\u0275elementStart"](4,"nb-card-body"),v["\u0275\u0275elementStart"](5,"nb-list"),v["\u0275\u0275template"](6,y,21,22,"nb-list-item",0),v["\u0275\u0275elementEnd"](),v["\u0275\u0275elementEnd"](),v["\u0275\u0275elementEnd"]()),2&e&&(v["\u0275\u0275advance"](2),v["\u0275\u0275textInterpolate1"](" ",v["\u0275\u0275pipeBind1"](3,2,"Message Center")," "),v["\u0275\u0275advance"](4),v["\u0275\u0275property"]("ngForOf",t.messages))},directives:[g.u,g.x,g.t,g.U,r.n,g.V,r.p,r.o,r.m],pipes:[h.c],styles:[".avatar[_ngcontent-%COMP%]{width:50px;height:50px}.avatar[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]{width:100%;position:relative;padding-top:100%;background-size:cover;background-repeat:no-repeat;border-radius:50%;box-shadow:0 0 5px .5px #fff}nb-list-item[_ngcontent-%COMP%]   .text-1[_ngcontent-%COMP%]{font-size:small;color:grey}"]}),e})();var _=n("hpVs"),w=n("eIep"),M=n("cp0P"),U=n("fUYe");function j(e,t){if(1&e&&(v["\u0275\u0275elementStart"](0,"span"),v["\u0275\u0275text"](1),v["\u0275\u0275pipe"](2,"translate"),v["\u0275\u0275pipe"](3,"translate"),v["\u0275\u0275elementEnd"]()),2&e){const e=v["\u0275\u0275nextContext"](2).$implicit,t=v["\u0275\u0275nextContext"]();v["\u0275\u0275advance"](1),v["\u0275\u0275textInterpolate2"]("",v["\u0275\u0275pipeBind1"](2,2,"Admin Center")," (",v["\u0275\u0275pipeBind1"](3,4,t.resolveSenderEmail(e)),")")}}function O(e,t){if(1&e&&(v["\u0275\u0275elementStart"](0,"span"),v["\u0275\u0275text"](1),v["\u0275\u0275pipe"](2,"translate"),v["\u0275\u0275elementEnd"]()),2&e){const e=v["\u0275\u0275nextContext"](2).$implicit,t=v["\u0275\u0275nextContext"]();v["\u0275\u0275advance"](1),v["\u0275\u0275textInterpolate"](v["\u0275\u0275pipeBind1"](2,1,t.resolveSenderEmail(e)))}}function P(e,t){if(1&e&&(v["\u0275\u0275elementStart"](0,"span"),v["\u0275\u0275text"](1),v["\u0275\u0275pipe"](2,"translate"),v["\u0275\u0275pipe"](3,"translate"),v["\u0275\u0275elementEnd"]()),2&e){const e=v["\u0275\u0275nextContext"](2).$implicit,t=v["\u0275\u0275nextContext"]();v["\u0275\u0275advance"](1),v["\u0275\u0275textInterpolate2"]("",v["\u0275\u0275pipeBind1"](2,2,"Admin Center")," (",v["\u0275\u0275pipeBind1"](3,4,t.resolveReceiverEmail(e)),")")}}function $(e,t){if(1&e&&(v["\u0275\u0275elementStart"](0,"span"),v["\u0275\u0275text"](1),v["\u0275\u0275pipe"](2,"translate"),v["\u0275\u0275elementEnd"]()),2&e){const e=v["\u0275\u0275nextContext"](2).$implicit,t=v["\u0275\u0275nextContext"]();v["\u0275\u0275advance"](1),v["\u0275\u0275textInterpolate"](v["\u0275\u0275pipeBind1"](2,1,t.resolveReceiverEmail(e)))}}function k(e,t){if(1&e&&(v["\u0275\u0275elementContainerStart"](0),v["\u0275\u0275element"](1,"img",21),v["\u0275\u0275elementContainerEnd"]()),2&e){const e=t.$implicit;v["\u0275\u0275advance"](1),v["\u0275\u0275property"]("src",e.file,v["\u0275\u0275sanitizeUrl"])}}const B=function(e){return{"background-image":e}};function F(e,t){if(1&e&&(v["\u0275\u0275elementStart"](0,"div",9),v["\u0275\u0275element"](1,"div",10),v["\u0275\u0275elementStart"](2,"div",11),v["\u0275\u0275elementStart"](3,"div",12),v["\u0275\u0275elementStart"](4,"div",13),v["\u0275\u0275elementStart"](5,"div",14),v["\u0275\u0275text"](6),v["\u0275\u0275elementEnd"](),v["\u0275\u0275text"](7),v["\u0275\u0275pipe"](8,"translate"),v["\u0275\u0275template"](9,j,4,6,"span",15),v["\u0275\u0275template"](10,O,3,3,"span",15),v["\u0275\u0275text"](11),v["\u0275\u0275pipe"](12,"translate"),v["\u0275\u0275template"](13,P,4,6,"span",15),v["\u0275\u0275template"](14,$,3,3,"span",15),v["\u0275\u0275elementEnd"](),v["\u0275\u0275elementStart"](15,"div",16),v["\u0275\u0275element"](16,"div",17),v["\u0275\u0275elementEnd"](),v["\u0275\u0275elementEnd"](),v["\u0275\u0275elementStart"](17,"div",18),v["\u0275\u0275elementStart"](18,"div",19),v["\u0275\u0275text"](19),v["\u0275\u0275elementEnd"](),v["\u0275\u0275elementStart"](20,"div",20),v["\u0275\u0275template"](21,k,2,1,"ng-container",3),v["\u0275\u0275elementEnd"](),v["\u0275\u0275elementEnd"](),v["\u0275\u0275elementEnd"](),v["\u0275\u0275elementEnd"]()),2&e){const e=v["\u0275\u0275nextContext"]().$implicit,t=v["\u0275\u0275nextContext"]();v["\u0275\u0275advance"](6),v["\u0275\u0275textInterpolate1"](" ",t.getFormatDate(e.created_at)," "),v["\u0275\u0275advance"](1),v["\u0275\u0275textInterpolate1"](" ",v["\u0275\u0275pipeBind1"](8,10,"From"),": "),v["\u0275\u0275advance"](2),v["\u0275\u0275property"]("ngIf",t.isUserAdmin(e.sender)),v["\u0275\u0275advance"](1),v["\u0275\u0275property"]("ngIf",!t.isUserAdmin(e.sender)),v["\u0275\u0275advance"](1),v["\u0275\u0275textInterpolate1"](" ",v["\u0275\u0275pipeBind1"](12,12,"To"),": "),v["\u0275\u0275advance"](2),v["\u0275\u0275property"]("ngIf",t.isUserAdmin(e.receiver)),v["\u0275\u0275advance"](1),v["\u0275\u0275property"]("ngIf",!t.isUserAdmin(e.receiver)),v["\u0275\u0275advance"](2),v["\u0275\u0275property"]("ngStyle",v["\u0275\u0275pureFunction1"](14,B,"url("+t.resolveSenderPictureUrl(e)+")")),v["\u0275\u0275advance"](3),v["\u0275\u0275textInterpolate1"](" ",e.content," "),v["\u0275\u0275advance"](2),v["\u0275\u0275property"]("ngForOf",e.attachedFiles)}}function A(e,t){if(1&e&&(v["\u0275\u0275elementContainerStart"](0),v["\u0275\u0275elementStart"](1,"a",29),v["\u0275\u0275element"](2,"img",21),v["\u0275\u0275elementEnd"](),v["\u0275\u0275elementContainerEnd"]()),2&e){const e=t.$implicit;v["\u0275\u0275advance"](1),v["\u0275\u0275propertyInterpolate"]("href",e.file,v["\u0275\u0275sanitizeUrl"]),v["\u0275\u0275advance"](1),v["\u0275\u0275property"]("src",e.file,v["\u0275\u0275sanitizeUrl"])}}function R(e,t){if(1&e&&(v["\u0275\u0275elementStart"](0,"div",9),v["\u0275\u0275elementStart"](1,"div",22),v["\u0275\u0275elementStart"](2,"div",23),v["\u0275\u0275elementStart"](3,"div",24),v["\u0275\u0275element"](4,"div",17),v["\u0275\u0275elementEnd"](),v["\u0275\u0275elementStart"](5,"div",25),v["\u0275\u0275elementStart"](6,"div",26),v["\u0275\u0275text"](7),v["\u0275\u0275elementEnd"](),v["\u0275\u0275text"](8),v["\u0275\u0275pipe"](9,"translate"),v["\u0275\u0275elementStart"](10,"span"),v["\u0275\u0275text"](11),v["\u0275\u0275elementEnd"](),v["\u0275\u0275text"](12),v["\u0275\u0275pipe"](13,"translate"),v["\u0275\u0275elementStart"](14,"span"),v["\u0275\u0275text"](15),v["\u0275\u0275elementEnd"](),v["\u0275\u0275elementEnd"](),v["\u0275\u0275elementEnd"](),v["\u0275\u0275elementStart"](16,"div",18),v["\u0275\u0275elementStart"](17,"div",27),v["\u0275\u0275text"](18),v["\u0275\u0275elementEnd"](),v["\u0275\u0275elementStart"](19,"div",28),v["\u0275\u0275template"](20,A,3,2,"ng-container",3),v["\u0275\u0275elementEnd"](),v["\u0275\u0275elementEnd"](),v["\u0275\u0275elementEnd"](),v["\u0275\u0275elementEnd"]()),2&e){const e=v["\u0275\u0275nextContext"]().$implicit,t=v["\u0275\u0275nextContext"]();v["\u0275\u0275advance"](4),v["\u0275\u0275property"]("ngStyle",v["\u0275\u0275pureFunction1"](12,B,"url("+t.resolveSenderPictureUrl(e)+")")),v["\u0275\u0275advance"](3),v["\u0275\u0275textInterpolate1"](" ",t.getFormatDate(e.created_at)," "),v["\u0275\u0275advance"](1),v["\u0275\u0275textInterpolate1"](" ",v["\u0275\u0275pipeBind1"](9,8,"From"),": "),v["\u0275\u0275advance"](3),v["\u0275\u0275textInterpolate"](t.resolveSenderEmail(e)),v["\u0275\u0275advance"](1),v["\u0275\u0275textInterpolate1"](" ",v["\u0275\u0275pipeBind1"](13,10,"To"),":"),v["\u0275\u0275advance"](3),v["\u0275\u0275textInterpolate"](t.resolveReceiverEmail(e)),v["\u0275\u0275advance"](3),v["\u0275\u0275textInterpolate1"](" ",e.content," "),v["\u0275\u0275advance"](2),v["\u0275\u0275property"]("ngForOf",e.attachedFiles)}}function T(e,t){if(1&e&&(v["\u0275\u0275elementStart"](0,"nb-list-item"),v["\u0275\u0275template"](1,F,22,16,"div",7),v["\u0275\u0275template"](2,R,21,14,"ng-template",null,8,v["\u0275\u0275templateRefExtractor"]),v["\u0275\u0275elementEnd"]()),2&e){const e=t.$implicit,n=v["\u0275\u0275reference"](3),r=v["\u0275\u0275nextContext"]();v["\u0275\u0275advance"](1),v["\u0275\u0275property"]("ngIf",e.sender.id!=(null==r.currentUser?null:r.currentUser.id))("ngIfElse",n)}}function V(e,t){if(1&e){const e=v["\u0275\u0275getCurrentView"]();v["\u0275\u0275elementStart"](0,"button",30),v["\u0275\u0275listener"]("click",(function(){return v["\u0275\u0275restoreView"](e),v["\u0275\u0275nextContext"]().isReplyMode=!0})),v["\u0275\u0275text"](1),v["\u0275\u0275pipe"](2,"translate"),v["\u0275\u0275elementEnd"]()}2&e&&(v["\u0275\u0275advance"](1),v["\u0275\u0275textInterpolate"](v["\u0275\u0275pipeBind1"](2,1,"Reply")))}function z(e,t){if(1&e){const e=v["\u0275\u0275getCurrentView"]();v["\u0275\u0275elementStart"](0,"div",31),v["\u0275\u0275elementStart"](1,"button",32),v["\u0275\u0275listener"]("click",(function(){return v["\u0275\u0275restoreView"](e),v["\u0275\u0275nextContext"]().isReplyMode=!1})),v["\u0275\u0275element"](2,"nb-icon",33),v["\u0275\u0275elementEnd"](),v["\u0275\u0275elementStart"](3,"ngx-reply",34),v["\u0275\u0275listener"]("onsend",(function(t){return v["\u0275\u0275restoreView"](e),v["\u0275\u0275nextContext"]().onSend(t)})),v["\u0275\u0275elementEnd"](),v["\u0275\u0275elementEnd"]()}if(2&e){const e=v["\u0275\u0275nextContext"]();v["\u0275\u0275advance"](3),v["\u0275\u0275property"]("isReplyMode",!0)("fromContact",e.currentUser)}}let N=(()=>{class e{constructor(e,t,n,r,i,a){this.messageSerivce=e,this.userSerivce=t,this.notificationService=n,this.route=r,this.router=i,this._location=a,this.destroy$=new p.a}ngOnInit(){this.userSerivce.getCurrentUser().subscribe(e=>{this.currentUser=e}),this.route.paramMap.pipe(Object(w.a)(e=>(this.headermsgId=Number(e.get("id")),Object(M.a)({user:this.userSerivce.getCurrentUser(),msg:this.messageSerivce.getMessageLinked(this.headermsgId)})))).subscribe(e=>{this.currentUser=e.user,this.messages=e.msg,this._initialize(),this.notificationService.onnew.pipe(Object(u.a)(this.destroy$)).subscribe(e=>{e.data.verb==d.a.MessageCreate&&e.receiver==this.currentUser.id&&this.messageSerivce.getMessageLinked(this.headermsgId).subscribe(e=>{this.messages=e,this._initialize()})})}),this.isReplyMode=!1}_initialize(){this.toContact=this.messages[0].sender.id==this.currentUser.id?this.messages[0].receiver:this.messages[0].sender;let e=this.messages[this.messages.length-1];0==e.is_read&&e.receiver.id==this.currentUser.id&&this.messageSerivce.markAsRead(e).subscribe(e=>{}),this.toChild=this.messages[0].child}isUserAdmin(e){return e.role==a.a.Admin}getFormatDate(e){let t=o(e);return t.isValid?t.format("LT"):""}goToMessageCenter(){this._location.back()}resolveSenderEmail(e){let t=e.sender;return t.id==this.currentUser.id?"me":t.role==a.a.Admin?`${t.first_name} ${t.last_name}`:t.role==a.a.Parent?e.child.first_name+" "+e.child.last_name:t.first_name+" "+t.last_name}resolveReceiverEmail(e){let t=e.receiver;return t.id==this.currentUser.id?"me":t.role==a.a.Admin?`${t.first_name} ${t.last_name}`:t.role==a.a.Parent?e.child.first_name+" "+e.child.last_name:t.first_name+" "+t.last_name}resolveReceiverPictureUrl(e){return e.receiver.role==a.a.Parent?e.child.photo:e.sender.picture}resolveSenderPictureUrl(e){return e.sender.role==a.a.Parent?e.child.photo:e.sender.picture}onSend(e){let t=this.messageSerivce.newMessage();t.subject=this.messages[0].subject,t.content=e.content,t.msgType=_.a.Normal,t.attachedFiles=e.fileIds,t.sender=this.currentUser,t.child=this.toChild,t.headerMessage=this.headermsgId,t.receiver=this.toContact,this.messageSerivce.sendMessage(t).subscribe(e=>{this.isReplyMode=!1,this.messageSerivce.getMessageLinked(this.headermsgId).subscribe(e=>{this.messages=e})})}}return e.\u0275fac=function(t){return new(t||e)(v["\u0275\u0275directiveInject"](s.a),v["\u0275\u0275directiveInject"](l.a),v["\u0275\u0275directiveInject"](c.a),v["\u0275\u0275directiveInject"](i.a),v["\u0275\u0275directiveInject"](i.c),v["\u0275\u0275directiveInject"](r.k))},e.\u0275cmp=v["\u0275\u0275defineComponent"]({type:e,selectors:[["ngx-message-detail"]],decls:14,vars:9,consts:[["nbButton","","ghost","",3,"nbTooltip","click"],["icon","arrow-back-outline",2,"color","white"],[2,"max-height","600px"],[4,"ngFor","ngForOf"],[1,"d-flex","justify-content-end"],["nbButton","","class","",3,"click",4,"ngIf"],["style","position: relative;",4,"ngIf"],["class","row w-100",4,"ngIf","ngIfElse"],["hostContent",""],[1,"row","w-100"],[1,"col-2"],[1,"col-10","justify-content-end","w-100"],[1,"row","justify-content-end"],[1,"text-1"],[1,"ml-2","date-text","text-right"],[4,"ngIf"],[1,"avatar","ml-2"],[1,"content",3,"ngStyle"],[1,"ml-3"],[1,"mt-2","mb-2","text-right"],[1,"row","attached-content","justify-content-end"],[1,"attached-img","mr-2","mt-2",3,"src"],[1,"col-10","w-100","ml-2"],[1,"row"],[1,"avatar","text-right"],[1,"text-1","ml-2"],[1,"date-text"],[1,"mt-2","mb-2"],[1,"row","attached-content"],["target","_blank",3,"href"],["nbButton","",1,"",3,"click"],[2,"position","relative"],["nbButton","","ghost","",2,"position","absolute","right","0px","top","0px","z-index","99",3,"click"],["icon","close-outline"],[3,"isReplyMode","fromContact","onsend"]],template:function(e,t){1&e&&(v["\u0275\u0275elementStart"](0,"nb-card"),v["\u0275\u0275elementStart"](1,"nb-card-header"),v["\u0275\u0275elementStart"](2,"button",0),v["\u0275\u0275listener"]("click",(function(){return t.goToMessageCenter()})),v["\u0275\u0275pipe"](3,"translate"),v["\u0275\u0275elementStart"](4,"nb-icon",1),v["\u0275\u0275text"](5,"arrow-back-outline"),v["\u0275\u0275elementEnd"](),v["\u0275\u0275elementEnd"](),v["\u0275\u0275text"](6),v["\u0275\u0275pipe"](7,"translate"),v["\u0275\u0275elementEnd"](),v["\u0275\u0275elementStart"](8,"nb-card-body"),v["\u0275\u0275elementStart"](9,"nb-list",2),v["\u0275\u0275template"](10,T,4,2,"nb-list-item",3),v["\u0275\u0275elementEnd"](),v["\u0275\u0275elementStart"](11,"div",4),v["\u0275\u0275template"](12,V,3,3,"button",5),v["\u0275\u0275elementEnd"](),v["\u0275\u0275template"](13,z,4,2,"div",6),v["\u0275\u0275elementEnd"](),v["\u0275\u0275elementEnd"]()),2&e&&(v["\u0275\u0275advance"](2),v["\u0275\u0275propertyInterpolate"]("nbTooltip",v["\u0275\u0275pipeBind1"](3,5,"Back")),v["\u0275\u0275advance"](4),v["\u0275\u0275textInterpolate1"](" ",v["\u0275\u0275pipeBind1"](7,7,"Messages")," "),v["\u0275\u0275advance"](4),v["\u0275\u0275property"]("ngForOf",t.messages),v["\u0275\u0275advance"](2),v["\u0275\u0275property"]("ngIf",!t.isReplyMode),v["\u0275\u0275advance"](1),v["\u0275\u0275property"]("ngIf",t.isReplyMode))},directives:[g.u,g.x,g.q,g.ub,g.I,g.t,g.U,r.n,r.o,g.V,r.p,U.a],pipes:[h.c],styles:[".avatar[_ngcontent-%COMP%]{width:50px;height:50px}.avatar[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]{width:100%;position:relative;padding-top:100%;background-size:cover;background-repeat:no-repeat;border-radius:50%;box-shadow:0 0 5px .5px #fff}nb-list-item[_ngcontent-%COMP%]   .text-1[_ngcontent-%COMP%]{font-size:small;color:grey}nb-list-item[_ngcontent-%COMP%]   .date-text[_ngcontent-%COMP%]{font-size:medium}.attached-content[_ngcontent-%COMP%]{flex-wrap:wrap}.attached-content[_ngcontent-%COMP%]   .attached-img[_ngcontent-%COMP%]{max-height:70px;border-radius:5px;border:1px solid #8f9bb3}"]}),e})();const D=[{path:"",component:E},{path:"compose",component:(()=>{class e{constructor(e,t,n){this.userService=e,this.messageSerivce=t,this.toastService=n}ngOnInit(){this.userService.getCurrentUser().subscribe(e=>{this.currentUser=e})}onSend(e){let t=[];e.to_contacts.forEach(n=>{let r=this.messageSerivce.newMessage();r.subject=e.subject,r.content=e.content,r.msgType=_.a.Normal,r.attachedFiles=e.isAttached?e.fileIds:[],r.sender=this.currentUser,r.child=n.child,r.receiver=n.user,t.push(this.messageSerivce.sendMessage(r))}),t.length>0&&Object(M.a)(t).subscribe(e=>{this.toastService.success("Message has been sent successfully","success")})}}return e.\u0275fac=function(t){return new(t||e)(v["\u0275\u0275directiveInject"](l.a),v["\u0275\u0275directiveInject"](s.a),v["\u0275\u0275directiveInject"](m.a))},e.\u0275cmp=v["\u0275\u0275defineComponent"]({type:e,selectors:[["ngx-compose-message"]],decls:1,vars:1,consts:[[3,"fromContact","onsend"]],template:function(e,t){1&e&&(v["\u0275\u0275elementStart"](0,"ngx-reply",0),v["\u0275\u0275listener"]("onsend",(function(e){return t.onSend(e)})),v["\u0275\u0275elementEnd"]()),2&e&&v["\u0275\u0275property"]("fromContact",t.currentUser)},directives:[U.a],styles:[""]}),e})()},{path:":id",component:N}];let L=(()=>{class e{}return e.\u0275mod=v["\u0275\u0275defineNgModule"]({type:e}),e.\u0275inj=v["\u0275\u0275defineInjector"]({factory:function(t){return new(t||e)},imports:[[i.g.forChild(D)],i.g]}),e})();var X=n("PCNd"),J=n("p0MU");let K=(()=>{class e{}return e.\u0275mod=v["\u0275\u0275defineNgModule"]({type:e}),e.\u0275inj=v["\u0275\u0275defineInjector"]({factory:function(t){return new(t||e)},imports:[[r.c,L,g.y,g.W,g.r,X.a,g.K,g.vb,J.a]]}),e})()}}]);